<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SERA AI</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro", "Tahoma", sans-serif;
    }

    body {
      background: #f5f5f7;
      color: #111827;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app {
      background: #ffffff;
      width: 100%;
      max-width: 720px;
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ÿ±ÿ£ÿ≥ ÿßŸÑÿµŸÅÿ≠ÿ© */
    .app-header {
      padding: 20px 18px 12px;
      border-bottom: 1px solid #e5e7eb;
      text-align: center;
    }

    .brand {
      font-size: 24px;
      font-weight: 800;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .brand-heart {
      font-size: 22px;
    }

    .brand-subtitle {
      margin-top: 8px;
      font-size: 13px;
      color: #6b7280;
    }

    /* ÿ±ÿ≥ÿßÿ¶ŸÑ */
    .chat-wrapper {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-height: calc(100vh - 210px);
    }

    .messages {
      flex: 1;
      padding: 14px 14px 6px;
      overflow-y: auto;
      background: #f9fafb;
    }

    .bubble-row {
      display: flex;
      margin-bottom: 8px;
    }

    .bubble-row.user {
      justify-content: flex-end;
    }

    .bubble-row.ai {
      justify-content: flex-start;
    }

    .bubble {
      padding: 10px 12px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.7;
      max-width: 92%;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .bubble.user-bubble {
      background: #e5e7eb;
      color: #111827;
    }

    .bubble.ai-bubble {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      color: #111827;
    }

    .bubble.system {
      font-size: 13px;
      color: #6b7280;
      background: transparent;
      border: none;
      text-align: center;
      margin: 4px auto 10px;
    }

    /* ŸÖÿ§ÿ¥ÿ± "ŸäŸÉÿ™ÿ®..." */
    .typing {
      font-size: 13px;
      color: #6b7280;
      padding: 4px 10px 8px;
    }

    /* ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÖŸàÿßÿ∂Ÿäÿπ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ© */
    .quick-topics {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 0 12px 10px;
    }

    .quick-chip {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      color: #111827;
      cursor: pointer;
      transition: background 0.15s, transform 0.08s, box-shadow 0.15s;
    }

    .quick-chip:hover {
      background: #111827;
      color: #ffffff;
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.18);
    }

    /* ÿ£ÿ≥ŸÅŸÑ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© (ÿßŸÑÿ•ÿØÿÆÿßŸÑ + ÿ≤ÿ± ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ) */
    .input-area {
      border-top: 1px solid #e5e7eb;
      padding: 10px;
      background: #ffffff;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .input-area-inner {
      flex: 1;
      display: flex;
      gap: 6px;
      align-items: center;
      background: #f3f4f6;
      border-radius: 999px;
      padding: 4px 10px 4px 4px;
    }

    .chat-input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 14px;
      padding: 6px 4px;
    }

    .chat-input::placeholder {
      color: #9ca3af;
    }

    .mic-btn {
      border: none;
      background: #ffffff;
      border-radius: 999px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(148, 163, 184, 0.5);
      transition: transform 0.08s, box-shadow 0.1s, background 0.1s;
    }

    .mic-btn.active {
      background: #111827;
      color: #ffffff;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.5);
    }

    .mic-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(148, 163, 184, 0.7);
    }

    .send-btn {
      border: none;
      background: #000000;
      color: #ffffff;
      font-size: 14px;
      padding: 10px 22px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.15s, transform 0.08s, box-shadow 0.15s;
      white-space: nowrap;
    }

    .send-btn:hover {
      background: #111827;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.35);
      transform: translateY(-1px);
    }

    .send-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.35);
    }

    .send-btn:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    @media (max-width: 480px) {
      .brand {
        font-size: 20px;
      }
      .messages {
        padding: 10px 8px 4px;
      }
      .bubble {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ÿßŸÑŸáŸäÿØÿ± -->
    <header class="app-header">
      <div class="brand">
        <span class="brand-heart">üñ§</span>
        <span>SERA AI</span>
      </div>
      <div class="brand-subtitle">
        ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉŸä ŸÑŸÑÿπŸÜÿßŸäÿ© ÿ®ÿßŸÑÿ®ÿ¥ÿ±ÿ© ŸàÿßŸÑÿ¥ÿπÿ± ŸàÿßŸÑÿ¨ÿ≥ŸÖ ‚ú®
      </div>
    </header>

    <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© -->
    <div class="chat-wrapper">
      <div id="messages" class="messages"></div>

      <!-- ÿ£ÿ≤ÿ±ÿßÿ± ŸÖŸàÿßÿ∂Ÿäÿπ ÿ≥ÿ±Ÿäÿπÿ© -->
      <div id="quickTopics" class="quick-topics"></div>
    </div>

    <!-- ÿßŸÑÿ•ÿØÿÆÿßŸÑ -->
    <div class="input-area">
      <div class="input-area-inner">
        <input
          id="chatInput"
          class="chat-input"
          type="text"
          placeholder="ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ ŸáŸÜÿß..."
        />
        <button id="micButton" class="mic-btn" title="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµŸàÿ™Ÿä">
          üéôÔ∏è
        </button>
      </div>
      <button id="sendButton" class="send-btn">ÿ•ÿ±ÿ≥ÿßŸÑ</button>
    </div>
  </div>

  <script>
    const backendURL = "https://sera-ai-backend-qhrd.onrender.com";

    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendButton");
    const micBtn = document.getElementById("micButton");
    const quickTopicsEl = document.getElementById("quickTopics");

    let typingEl = null;
    let isSending = false;
    let recognition = null;

    // ŸÖŸàÿßÿ∂Ÿäÿπ ÿ≥ÿ±Ÿäÿπÿ©
    const quickTopics = [
      { label: "ÿ±Ÿàÿ™ŸäŸÜ ŸÑŸÑÿ®ÿ¥ÿ±ÿ© ÿßŸÑŸÖÿÆÿ™ŸÑÿ∑ÿ©", prompt: "ÿßÿ®ÿ∫Ÿâ ÿ±Ÿàÿ™ŸäŸÜ ŸäŸàŸÖŸä ŸÉÿßŸÖŸÑ ŸÑŸÑÿ®ÿ¥ÿ±ÿ© ÿßŸÑŸÖÿÆÿ™ŸÑÿ∑ÿ© ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©." },
      { label: "ÿ™Ÿàÿ≠ŸäÿØ ŸÑŸàŸÜ ÿßŸÑÿ¨ÿ≥ŸÖ", prompt: "ÿßÿ®ÿ∫Ÿâ ÿÆÿ∑ÿ© ÿπŸÜÿßŸäÿ© ŸÑÿ™Ÿàÿ≠ŸäÿØ ŸÑŸàŸÜ ÿßŸÑÿ¨ÿ≥ŸÖ Ÿàÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ™ÿµÿ®ÿ∫ÿßÿ™." },
      { label: "ÿ≠ÿ® ÿßŸÑÿ¥ÿ®ÿßÿ®", prompt: "ÿßŸäÿ¥ ÿßŸÅÿ∂ŸÑ ÿ±Ÿàÿ™ŸäŸÜ ŸàŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑÿπŸÑÿßÿ¨ ÿ≠ÿ® ÿßŸÑÿ¥ÿ®ÿßÿ® Ÿàÿ¢ÿ´ÿßÿ±Ÿáÿü" },
      { label: "ÿ±Ÿàÿ™ŸäŸÜ ŸÑŸÑÿ¥ÿπÿ± ÿßŸÑÿ¨ÿßŸÅ", prompt: "ÿßÿ®ÿ∫Ÿâ ÿ±Ÿàÿ™ŸäŸÜ ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑŸÑÿ¥ÿπÿ± ÿßŸÑÿ¨ÿßŸÅ ŸàÿßŸÑŸÖÿ™ŸÇÿµŸÅ." }
    ];

    // ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ≥ÿßŸÑÿ© ŸÅŸä ÿßŸÑŸàÿßÿ¨Ÿáÿ©
    function addMessage(text, sender = "ai", options = {}) {
      const { isSystem = false, typeWriter = false } = options;

      if (isSystem) {
        const sys = document.createElement("div");
        sys.className = "bubble system";
        sys.textContent = text;
        messagesEl.appendChild(sys);
        scrollToBottom();
        return;
      }

      const row = document.createElement("div");
      row.className = "bubble-row " + (sender === "user" ? "user" : "ai");

      const bubble = document.createElement("div");
      bubble.className =
        "bubble " + (sender === "user" ? "user-bubble" : "ai-bubble");

      row.appendChild(bubble);
      messagesEl.appendChild(row);

      if (typeWriter) {
        typeText(bubble, text);
      } else {
        bubble.textContent = text;
      }

      scrollToBottom();
    }

    function scrollToBottom() {
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // ŸÖÿ§ÿ¥ÿ± "SERA AI ŸäŸÉÿ™ÿ®..."
    function showTyping() {
      hideTyping();
      typingEl = document.createElement("div");
      typingEl.className = "typing";
      typingEl.textContent = "SERA AI ŸäŸÉÿ™ÿ®...";
      messagesEl.appendChild(typingEl);
      scrollToBottom();
    }

    function hideTyping() {
      if (typingEl && typingEl.parentNode) {
        typingEl.parentNode.removeChild(typingEl);
      }
      typingEl = null;
    }

    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÉÿ™ÿßÿ®ÿ© (ÿ≠ÿ±ŸÅ ÿ≠ÿ±ŸÅ)
    function typeText(element, text, speed = 18) {
      element.textContent = "";
      let i = 0;
      const interval = setInterval(() => {
        element.textContent += text.charAt(i);
        i++;
        if (i >= text.length) {
          clearInterval(interval);
        }
        scrollToBottom();
      }, speed);
    }

    // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
    async function sendMessage(customText) {
      if (isSending) return;

      const raw = typeof customText === "string" ? customText : inputEl.value;
      const text = (raw || "").trim();
      if (!text) return;

      // ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
      addMessage(text, "user");
      inputEl.value = "";
      inputEl.focus();

      isSending = true;
      sendBtn.disabled = true;
      showTyping();

      try {
        const res = await fetch(backendURL + "/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        hideTyping();

        const reply =
          (data && (data.reply || data.answer || data.content)) ||
          "ÿπÿ∞ÿ±Ÿãÿßÿå ŸÑŸÖ ÿ£ÿ≥ÿ™ÿ∑ÿπ ŸÅŸáŸÖ ÿ≥ÿ§ÿßŸÑŸÉ. ÿ≠ÿßŸàŸÑ ÿ£ŸÜ ÿ™ÿπŸäÿØ ÿµŸäÿßÿ∫ÿ™Ÿá.";

        addMessage(reply, "ai", { typeWriter: true });
      } catch (err) {
        console.error(err);
        hideTyping();
        addMessage(
          "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÄ SERA AI.\nÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ÿ®ÿπÿØ ŸÑÿ≠ÿ∏ÿßÿ™.",
          "ai"
        );
      } finally {
        isSending = false;
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    // ÿ™ŸáŸäÿ¶ÿ© ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÖŸàÿßÿ∂Ÿäÿπ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©
    function renderQuickTopics() {
      quickTopicsEl.innerHTML = "";
      quickTopics.forEach((t) => {
        const chip = document.createElement("button");
        chip.className = "quick-chip";
        chip.textContent = t.label;
        chip.addEventListener("click", () => sendMessage(t.prompt));
        quickTopicsEl.appendChild(chip);
      });
    }

    // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÖÿßŸäŸÉ (ÿ•ŸÜ ŸÉÿßŸÜ ŸÖÿ™ŸàŸÅÿ±)
    function setupSpeechRecognition() {
      const SR =
        window.SpeechRecognition ||
        window.webkitSpeechRecognition ||
        window.mozSpeechRecognition;

      if (!SR) {
        micBtn.style.display = "none";
        return;
      }

      recognition = new SR();
      recognition.lang = "ar-SA";
      recognition.interimResults = false;

      recognition.onstart = () => {
        micBtn.classList.add("active");
      };

      recognition.onend = () => {
        micBtn.classList.remove("active");
      };

      recognition.onerror = () => {
        micBtn.classList.remove("active");
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        if (transcript) {
          inputEl.value = transcript;
          sendMessage();
        }
      };

      micBtn.addEventListener("click", () => {
        try {
          recognition.start();
        } catch (e) {
          // ŸÅŸä ÿ®ÿπÿ∂ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ÿßÿ™ start ŸÑÿß ÿ™Ÿèÿ≥ÿ™ÿØÿπŸâ ŸÖÿ±ÿ™ŸäŸÜ ÿ®ÿ≥ÿ±ÿπÿ©
        }
      });
    }

    // ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
    function initChat() {
      renderQuickTopics();
      setupSpeechRecognition();

      // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ®Ÿäÿ©
      addMessage(
        "ÿ£ŸáŸÑŸãÿß üëã\nÿ£ŸÜÿß SERA AIÿå ŸÖÿ≥ÿßÿπÿØŸÉ ÿßŸÑÿ∞ŸÉŸä ŸÑŸÑÿπŸÜÿßŸäÿ© ÿ®ÿßŸÑÿ®ÿ¥ÿ±ÿ© ŸàÿßŸÑÿ¥ÿπÿ± ŸàÿßŸÑÿ¨ÿ≥ŸÖ.\nÿßŸÉÿ™ÿ® ŸÖÿ¥ŸÉŸÑÿ™ŸÉ ÿ£Ÿà ŸáÿØŸÅŸÉ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑÿå ÿ£Ÿà ÿßÿÆÿ™ÿ± ÿ£ÿ≠ÿØ ÿßŸÑŸÖŸàÿßÿ∂Ÿäÿπ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ© ÿ®ÿßŸÑÿ£ÿπŸÑŸâ.",
        "ai",
        { typeWriter: true }
      );
    }

    // ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
    sendBtn.addEventListener("click", () => sendMessage());
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // ÿ™ÿ¥ÿ∫ŸäŸÑ
    initChat();
  </script>
</body>
</html>